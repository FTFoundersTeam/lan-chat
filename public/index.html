<!DOCTYPE html>
<html>
<head>
  <title>LAN Chat</title>
  <style>
    body {
      background: #0b0b0b;
      color: #00ffcc;
      font-family: monospace;
      padding: 20px;
    }

    .container {
      display: flex;
      gap: 20px;
    }

    #chat {
      border: 1px solid #00ffcc;
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      flex: 3;
    }

    #users {
      border: 1px solid #00ffcc;
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      flex: 1;
    }

    input {
      width: 80%;
      padding: 8px;
      background: black;
      color: #00ffcc;
      border: 1px solid #00ffcc;
      margin-top: 10px;
    }

    button {
      padding: 8px;
      background: #00ffcc;
      border: none;
      cursor: pointer;
    }

    h3 {
      margin-top: 0;
    }
  </style>
</head>
<body>

<h2>LAN Chat</h2>

<div class="container">
  <!-- Chat -->
  <div id="chat"></div>

  <!-- Users -->
  <div id="users">
    <h3>Users</h3>
    <div><strong>Online:</strong>
      <ul id="onlineList"></ul>
    </div>
    <div><strong>Offline:</strong>
      <ul id="offlineList"></ul>
    </div>
  </div>
</div>

<input id="msg" placeholder="type message..." />
<button onclick="send()">Send</button>

<script>
async function loadMessages() {
  const res = await fetch('/api/messages');
  const data = await res.json();

  const chat = document.getElementById('chat');
  chat.innerHTML = "";

  data.forEach(m => {
    const div = document.createElement('div');
    const t = new Date(m.time).toLocaleTimeString();
    div.textContent = `[${t}] [${m.ip}] ${m.text}`;
    chat.appendChild(div);
  });

  chat.scrollTop = chat.scrollHeight;
}

async function loadUsers() {
  const res = await fetch('/api/users');
  const data = await res.json();

  const onlineUl = document.getElementById('onlineList');
  const offlineUl = document.getElementById('offlineList');

  onlineUl.innerHTML = "";
  offlineUl.innerHTML = "";

  data.online.forEach(ip => {
    const li = document.createElement('li');
    li.textContent = ip;
    onlineUl.appendChild(li);
  });

  data.offline.forEach(ip => {
    const li = document.createElement('li');
    li.textContent = ip;
    offlineUl.appendChild(li);
  });
}

async function send() {
  const input = document.getElementById('msg');
  const text = input.value.trim();
  if (!text) return;

  await fetch('/api/send', {
    method: 'POST',
    body: JSON.stringify({ text }),
  });

  input.value = "";
  loadMessages();
}

// refresh both every second
setInterval(loadMessages, 1000);
setInterval(loadUsers, 1000);

// initial load
loadMessages();
loadUsers();
</script>

</body>
</html>
